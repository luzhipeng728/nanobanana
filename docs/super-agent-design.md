# è¶…çº§æç¤ºè¯æ™ºèƒ½ä½“ç³»ç»Ÿè®¾è®¡

## ä¸€ã€ç³»ç»Ÿæ¶æ„æ¦‚è§ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         ç”¨æˆ·è¾“å…¥                                        â”‚
â”‚    "å¸®æˆ‘ç”Ÿæˆä¸€ä¸ªäº§å“å±•ç¤ºå›¾ï¼Œæ‰‹æŒé€æ˜å¡ç‰‡é£æ ¼ï¼Œå±•ç¤ºæˆ‘çš„AIå¹³å°"              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ğŸ§  è¶…çº§æ™ºèƒ½ä½“æ ¸å¿ƒ (ReAct Loop)                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Thought: åˆ†æç”¨æˆ·éœ€æ±‚ï¼Œè¯†åˆ«åœºæ™¯ç±»å‹                               â”‚  â”‚
â”‚  â”‚  Action: è°ƒç”¨ skill_matcher å·¥å…·åŒ¹é…é¢„è®¾æŠ€èƒ½                       â”‚  â”‚
â”‚  â”‚  Observation: åŒ¹é…åˆ° "product-showcase" æŠ€èƒ½                      â”‚  â”‚
â”‚  â”‚                                                                   â”‚  â”‚
â”‚  â”‚  Thought: éœ€è¦è·å–æŠ€èƒ½è¯¦æƒ…å’Œæ¨¡æ¿                                   â”‚  â”‚
â”‚  â”‚  Action: è°ƒç”¨ load_skill å·¥å…·åŠ è½½å®Œæ•´æŠ€èƒ½å†…å®¹                      â”‚  â”‚
â”‚  â”‚  Observation: è·å¾—å®Œæ•´çš„æç¤ºè¯æ¨¡æ¿å’Œå‚æ•°è¯´æ˜                        â”‚  â”‚
â”‚  â”‚                                                                   â”‚  â”‚
â”‚  â”‚  Thought: éœ€è¦æ ¹æ®ç”¨æˆ·å…·ä½“éœ€æ±‚å¡«å……æ¨¡æ¿                             â”‚  â”‚
â”‚  â”‚  Action: è°ƒç”¨ generate_prompt å·¥å…·ç”Ÿæˆåˆç‰ˆæç¤ºè¯                   â”‚  â”‚
â”‚  â”‚  Observation: ç”Ÿæˆäº† V1 ç‰ˆæœ¬æç¤ºè¯                                 â”‚  â”‚
â”‚  â”‚                                                                   â”‚  â”‚
â”‚  â”‚  Thought: éœ€è¦éªŒè¯æç¤ºè¯è´¨é‡ï¼Œå¯èƒ½éœ€è¦æœç´¢å‚è€ƒèµ„æ–™                  â”‚  â”‚
â”‚  â”‚  Action: è°ƒç”¨ web_search å·¥å…·æœç´¢æœ€ä½³å®è·µ                          â”‚  â”‚
â”‚  â”‚  Observation: æ‰¾åˆ°ä¸€äº›ä¼˜åŒ–æŠ€å·§                                     â”‚  â”‚
â”‚  â”‚                                                                   â”‚  â”‚
â”‚  â”‚  Thought: ç»“åˆæœç´¢ç»“æœä¼˜åŒ–æç¤ºè¯                                   â”‚  â”‚
â”‚  â”‚  Action: è°ƒç”¨ optimize_prompt å·¥å…·                                â”‚  â”‚
â”‚  â”‚  Observation: ç”Ÿæˆäº† V2 ç‰ˆæœ¬æç¤ºè¯                                 â”‚  â”‚
â”‚  â”‚                                                                   â”‚  â”‚
â”‚  â”‚  Thought: æç¤ºè¯å·²è¶³å¤Ÿå®Œå–„ï¼Œå¯ä»¥è¾“å‡º                               â”‚  â”‚
â”‚  â”‚  Action: è°ƒç”¨ finalize_output å·¥å…·                                â”‚  â”‚
â”‚  â”‚  Observation: ä»»åŠ¡å®Œæˆ                                            â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         æœ€ç»ˆè¾“å‡º                                        â”‚
â”‚    å®Œæ•´çš„è‹±æ–‡æç¤ºè¯ + ä¸­æ–‡æ–‡å­—æ¸…å• + ç”Ÿæˆå»ºè®®                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## äºŒã€æŠ€èƒ½åº“è®¾è®¡ (Skills Library)

### 2.1 æŠ€èƒ½å…ƒæ•°æ®ç»“æ„

```typescript
// src/types/super-agent.ts

export interface SkillMetadata {
  id: string;                    // æŠ€èƒ½å”¯ä¸€æ ‡è¯†
  name: string;                  // æŠ€èƒ½åç§°
  description: string;           // æŠ€èƒ½æè¿°ï¼ˆç”¨äºåŒ¹é…ï¼‰
  keywords: string[];            // è§¦å‘å…³é”®è¯
  category: SkillCategory;       // æŠ€èƒ½åˆ†ç±»
  difficulty: 'easy' | 'medium' | 'hard';  // å¤æ‚åº¦
  requiredInputs: string[];      // å¿…éœ€çš„ç”¨æˆ·è¾“å…¥
  optionalInputs: string[];      // å¯é€‰çš„ç”¨æˆ·è¾“å…¥
}

export interface SkillTemplate {
  metadata: SkillMetadata;
  basePrompt: string;            // åŸºç¡€æç¤ºè¯æ¨¡æ¿
  variables: SkillVariable[];    // å¯æ›¿æ¢å˜é‡
  examples: SkillExample[];      // ä½¿ç”¨ç¤ºä¾‹
  qualityChecklist: string[];    // è´¨é‡æ£€æŸ¥æ¸…å•
  commonIssues: CommonIssue[];   // å¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ
}

export type SkillCategory =
  | 'product-display'    // äº§å“å±•ç¤º
  | 'tutorial'           // æ•™ç¨‹å›¾è§£
  | 'storytelling'       // æ•…äº‹åœºæ™¯
  | 'data-visualization' // æ•°æ®å¯è§†åŒ–
  | 'architecture'       // æ¶æ„å›¾
  | 'lifestyle';         // ç”Ÿæ´»åœºæ™¯

export interface SkillVariable {
  name: string;          // å˜é‡å
  description: string;   // å˜é‡è¯´æ˜
  type: 'text' | 'list' | 'color' | 'style';
  required: boolean;
  defaultValue?: string;
  examples: string[];
}

export interface SkillExample {
  userRequest: string;   // ç”¨æˆ·åŸå§‹éœ€æ±‚
  filledPrompt: string;  // å¡«å……åçš„æç¤ºè¯
  chineseTexts: string[]; // ä¸­æ–‡æ–‡å­—æ¸…å•
}

export interface CommonIssue {
  issue: string;         // é—®é¢˜æè¿°
  solution: string;      // è§£å†³æ–¹æ¡ˆ
  promptFix: string;     // æç¤ºè¯ä¿®å¤è¯­å¥
}
```

### 2.2 é¢„è®¾æŠ€èƒ½å®šä¹‰

```typescript
// src/data/skills/index.ts

export const SKILL_LIBRARY: Record<string, SkillTemplate> = {

  // ========== æŠ€èƒ½1: äº§å“åç‰‡å±•ç¤º ==========
  'product-showcase': {
    metadata: {
      id: 'product-showcase',
      name: 'äº§å“åç‰‡å±•ç¤ºå›¾',
      description: 'ç”Ÿæˆæ‰‹æŒé€æ˜å¡ç‰‡é£æ ¼çš„äº§å“å±•ç¤ºå›¾ï¼Œé€‚åˆå±•ç¤ºAppã€å¹³å°ã€å“ç‰Œç­‰',
      keywords: ['äº§å“å±•ç¤º', 'åç‰‡', 'æ‰‹æŒå¡ç‰‡', 'é€æ˜å¡ç‰‡', 'Appå±•ç¤º', 'å“ç‰Œå±•ç¤º', 'ç»ç’ƒå¡ç‰‡', 'éœ“è™¹ç¯æ•ˆæœ'],
      category: 'product-display',
      difficulty: 'medium',
      requiredInputs: ['äº§å“åç§°', 'äº§å“åŠŸèƒ½åˆ—è¡¨'],
      optionalInputs: ['ç”¨æˆ·å', 'ç½‘ç«™URL', 'slogan', 'å“ç‰Œé¢œè‰²']
    },
    basePrompt: `A hand holding a glowing transparent glass card in the dark, the card displays {{PRODUCT_TYPE}} interface. The card shows a logo and title "{{PRODUCT_NAME}}" {{BADGE_TEXT}}, {{USERNAME_TEXT}}, tagline "{{SLOGAN}}", {{URL_TEXT}}, featuring {{FEATURE_ICONS}}. The card has beautiful gradient neon edge lighting in {{COLORS}} colors, holographic glass material effect. Photorealistic, cinematic dramatic lighting, pure black background, shallow depth of field, professional photography, ultra high quality, 8K resolution.`,
    variables: [
      {
        name: 'PRODUCT_NAME',
        description: 'äº§å“åç§°ï¼Œå°†æ˜¾ç¤ºåœ¨å¡ç‰‡æ ‡é¢˜ä½ç½®',
        type: 'text',
        required: true,
        examples: ['æ™ºç»˜æ— é™', 'CreativeAI', 'çµæ„Ÿå·¥åŠ']
      },
      {
        name: 'PRODUCT_TYPE',
        description: 'äº§å“ç±»å‹æè¿°',
        type: 'text',
        required: true,
        defaultValue: 'a creative AI platform',
        examples: ['a creative AI platform', 'a mobile app', 'a SaaS dashboard']
      },
      {
        name: 'SLOGAN',
        description: 'äº§å“æ ‡è¯­',
        type: 'text',
        required: false,
        examples: ['AIæ— é™ç”»å¸ƒ Â· åˆ›æ„æ— ç•Œ', 'è®©åˆ›ä½œæ›´ç®€å•']
      },
      {
        name: 'FEATURE_ICONS',
        description: 'åŠŸèƒ½å›¾æ ‡åˆ—è¡¨ï¼Œæ ¼å¼ï¼štool icons with labels: åŠŸèƒ½1, åŠŸèƒ½2...',
        type: 'list',
        required: true,
        examples: ['tool icons with labels: å›¾åƒç”Ÿæˆ (Generator), AIæ™ºèƒ½ä½“ (Agent), è§†é¢‘ç”Ÿæˆ (Video)']
      },
      {
        name: 'COLORS',
        description: 'éœ“è™¹ç¯é¢œè‰²',
        type: 'color',
        required: false,
        defaultValue: 'purple, pink and cyan',
        examples: ['purple, pink and cyan', 'blue and gold', 'green and white']
      },
      {
        name: 'USERNAME_TEXT',
        description: 'ç”¨æˆ·åæ˜¾ç¤º',
        type: 'text',
        required: false,
        examples: ['username "@luzhipeng"', '']
      },
      {
        name: 'URL_TEXT',
        description: 'ç½‘ç«™URL',
        type: 'text',
        required: false,
        examples: ['website URL "canvas.luzhipeng.com"', '']
      },
      {
        name: 'BADGE_TEXT',
        description: 'è®¤è¯å¾½ç« ',
        type: 'text',
        required: false,
        defaultValue: 'with a verified blue badge',
        examples: ['with a verified blue badge', 'with a premium gold badge', '']
      }
    ],
    examples: [
      {
        userRequest: 'å¸®æˆ‘ç”Ÿæˆä¸€ä¸ªäº§å“å±•ç¤ºå›¾ï¼Œå±•ç¤ºæˆ‘çš„AIç»˜ç”»å¹³å°"æ™ºç»˜æ— é™"ï¼ŒåŠŸèƒ½æœ‰å›¾åƒç”Ÿæˆã€AIæ™ºèƒ½ä½“ã€è§†é¢‘ç”Ÿæˆ',
        filledPrompt: 'A hand holding a glowing transparent glass card in the dark, the card displays a creative AI platform interface. The card shows a logo and title "æ™ºç»˜æ— é™" with a verified blue badge, tagline "AIæ— é™ç”»å¸ƒ Â· åˆ›æ„æ— ç•Œ", featuring tool icons with labels: å›¾åƒç”Ÿæˆ (Generator), AIæ™ºèƒ½ä½“ (Agent), è§†é¢‘ç”Ÿæˆ (Video). The card has beautiful gradient neon edge lighting in purple, pink and cyan colors, holographic glass material effect. Photorealistic, cinematic dramatic lighting, pure black background, shallow depth of field, professional photography, ultra high quality, 8K resolution.',
        chineseTexts: ['æ™ºç»˜æ— é™', 'AIæ— é™ç”»å¸ƒ Â· åˆ›æ„æ— ç•Œ', 'å›¾åƒç”Ÿæˆ', 'AIæ™ºèƒ½ä½“', 'è§†é¢‘ç”Ÿæˆ']
      }
    ],
    qualityChecklist: [
      'äº§å“åç§°æ˜¯å¦å®Œæ•´æ˜¾ç¤ºï¼ˆä¸­æ–‡æ— ä¹±ç ï¼‰',
      'åŠŸèƒ½åˆ—è¡¨æ˜¯å¦æ¸…æ™°å¯è¯»',
      'éœ“è™¹ç¯æ•ˆæœæ˜¯å¦ç¾è§‚',
      'å¡ç‰‡æ˜¯å¦æœ‰ç»ç’ƒè´¨æ„Ÿ',
      'èƒŒæ™¯æ˜¯å¦ä¸ºçº¯é»‘è‰²'
    ],
    commonIssues: [
      {
        issue: 'ä¸­æ–‡æ–‡å­—æ˜¾ç¤ºä¸å®Œæ•´æˆ–ä¹±ç ',
        solution: 'ä½¿ç”¨æ›´å°‘çš„ä¸­æ–‡æ–‡å­—ï¼Œæˆ–å°†é•¿æ–‡å­—æ‹†åˆ†',
        promptFix: 'with Chinese text "XXX" clearly and completely displayed'
      },
      {
        issue: 'åŠŸèƒ½å›¾æ ‡è¿‡äºæ‹¥æŒ¤',
        solution: 'å‡å°‘åŠŸèƒ½æ•°é‡ï¼ˆå»ºè®®4-5ä¸ªï¼‰',
        promptFix: 'with generous spacing between each icon'
      },
      {
        issue: 'å¡ç‰‡ä¸å¤Ÿé€æ˜',
        solution: 'å¼ºè°ƒç»ç’ƒæè´¨',
        promptFix: 'highly transparent frosted glass with visible light refraction'
      }
    ]
  },

  // ========== æŠ€èƒ½2: åŸºç¡€æ•™ç¨‹å›¾ ==========
  'tutorial-infographic': {
    metadata: {
      id: 'tutorial-infographic',
      name: 'åŸºç¡€ç©æ³•æ•™ç¨‹å›¾',
      description: 'ç”Ÿæˆåˆ†æ­¥éª¤çš„äº§å“ä½¿ç”¨æ•™ç¨‹å›¾ï¼Œç°ä»£UIé£æ ¼ï¼Œé€‚åˆå±•ç¤ºæ“ä½œæµç¨‹',
      keywords: ['æ•™ç¨‹', 'ä½¿ç”¨è¯´æ˜', 'æ“ä½œæŒ‡å—', 'æ­¥éª¤å›¾', 'æµç¨‹å›¾', 'æ–°æ‰‹å¼•å¯¼', 'UIæ•™ç¨‹', 'åŠŸèƒ½ä»‹ç»'],
      category: 'tutorial',
      difficulty: 'hard',
      requiredInputs: ['äº§å“åç§°', 'æ­¥éª¤åˆ—è¡¨'],
      optionalInputs: ['å“ç‰Œé¢œè‰²', 'é£æ ¼åå¥½']
    },
    basePrompt: `A modern tutorial infographic showing how to use {{PRODUCT_NAME}}. The image is divided into a step-by-step visual guide with numbered steps flowing from left to right. {{STEPS_CONTENT}}. The overall design is clean, modern UI style with {{COLORS}} accent colors, dark mode interface, soft glow effects, professional product demonstration style, 4K resolution.`,
    variables: [
      {
        name: 'PRODUCT_NAME',
        description: 'äº§å“åç§°',
        type: 'text',
        required: true,
        examples: ['an AI infinite canvas platform', 'a photo editing app']
      },
      {
        name: 'STEPS_CONTENT',
        description: 'æ­¥éª¤å†…å®¹ï¼Œæ¯ä¸ªæ­¥éª¤åŒ…å«ï¼šæè¿° + æ ‡ç­¾',
        type: 'list',
        required: true,
        examples: ['Step 1: A left sidebar panel showing tool icons with "AIæ™ºèƒ½ä½“" highlighted, label "é€‰æ‹©å·¥å…·". Step 2: A canvas showing the node placed, label "æ”¾ç½®èŠ‚ç‚¹"']
      },
      {
        name: 'COLORS',
        description: 'ä¸»é¢˜è‰²',
        type: 'color',
        required: false,
        defaultValue: 'purple and cyan',
        examples: ['purple and cyan', 'blue and orange']
      }
    ],
    examples: [
      {
        userRequest: 'å¸®æˆ‘åšä¸€ä¸ªAIç”»å¸ƒçš„ä½¿ç”¨æ•™ç¨‹ï¼ŒåŒ…å«é€‰æ‹©å·¥å…·ã€ä¸Šä¼ å›¾ç‰‡ã€è¾“å…¥æç¤ºè¯ã€ç”Ÿæˆå›¾ç‰‡4ä¸ªæ­¥éª¤',
        filledPrompt: 'A modern tutorial infographic showing how to use an AI infinite canvas platform. The image is divided into a step-by-step visual guide with numbered steps flowing from left to right. Step 1: A left sidebar panel showing tool icons with "AIæ™ºèƒ½ä½“" highlighted and being dragged with a cursor arrow, label "é€‰æ‹©AIæ™ºèƒ½ä½“ æ‹–æ‹½åˆ°ç”»å¸ƒ". Step 2: A canvas workspace showing the agent node placed, with a photo being uploaded and connected by a glowing line to the agent node, label "ä¸Šä¼ ç…§ç‰‡ è¿çº¿åˆ°èŠ‚ç‚¹". Step 3: A text input box showing creative prompt being typed, label "è¾“å…¥ä½ çš„åˆ›æ„æƒ³æ³•". Step 4: Multiple beautiful AI-generated images appearing on the canvas, label "ç²¾ç¾å›¾ç‰‡ç”Ÿæˆå®Œæˆ". The overall design is clean, modern UI style with purple and cyan accent colors, dark mode interface, soft glow effects, professional product demonstration style, 4K resolution.',
        chineseTexts: ['AIæ™ºèƒ½ä½“', 'é€‰æ‹©AIæ™ºèƒ½ä½“ æ‹–æ‹½åˆ°ç”»å¸ƒ', 'ä¸Šä¼ ç…§ç‰‡ è¿çº¿åˆ°èŠ‚ç‚¹', 'è¾“å…¥ä½ çš„åˆ›æ„æƒ³æ³•', 'ç²¾ç¾å›¾ç‰‡ç”Ÿæˆå®Œæˆ']
      }
    ],
    qualityChecklist: [
      'æ­¥éª¤ç¼–å·æ˜¯å¦æ¸…æ™°å¯è§',
      'æ¯ä¸ªæ­¥éª¤çš„æ ‡ç­¾æ–‡å­—æ˜¯å¦æ­£ç¡®',
      'æ­¥éª¤ä¹‹é—´çš„æµç¨‹ç®­å¤´æ˜¯å¦è¿è´¯',
      'UIå…ƒç´ æ˜¯å¦ç¬¦åˆç°ä»£è®¾è®¡é£æ ¼',
      'æ•´ä½“å¸ƒå±€æ˜¯å¦å¹³è¡¡'
    ],
    commonIssues: [
      {
        issue: 'æ­¥éª¤è¿‡å¤šå¯¼è‡´å›¾ç‰‡æ‹¥æŒ¤',
        solution: 'é™åˆ¶åœ¨4-5ä¸ªæ­¥éª¤',
        promptFix: 'with clear separation and generous white space between steps'
      },
      {
        issue: 'æ­¥éª¤æ ‡ç­¾æ–‡å­—ä¸æ¸…æ™°',
        solution: 'ä½¿ç”¨æ›´å¤§çš„æ ‡ç­¾æ–‡å­—',
        promptFix: 'with large, clearly readable Chinese labels'
      }
    ]
  },

  // ========== æŠ€èƒ½3: çš®å…‹æ–¯é£æ ¼è¿ç»­æ•…äº‹ ==========
  'pixar-story-sequence': {
    metadata: {
      id: 'pixar-story-sequence',
      name: 'çš®å…‹æ–¯é£æ ¼è¿ç»­æ•…äº‹åœºæ™¯',
      description: 'ç”Ÿæˆçš®å…‹æ–¯/è¿ªå£«å°¼åŠ¨ç”»é£æ ¼çš„è¿ç»­æ•…äº‹åœºæ™¯å›¾ï¼ŒåŒ…å«è§’è‰²ä¸€è‡´æ€§å’Œå‰§æƒ…å‘å±•',
      keywords: ['çš®å…‹æ–¯', 'è¿ªå£«å°¼', 'åŠ¨ç”»é£æ ¼', 'æ•…äº‹åœºæ™¯', 'è¿ç»­å‰§æƒ…', 'è§’è‰²è®¾è®¡', '3DåŠ¨ç”»', 'ç”µå½±æ„Ÿ'],
      category: 'storytelling',
      difficulty: 'hard',
      requiredInputs: ['è§’è‰²æè¿°', 'æ•…äº‹å¤§çº²', 'åœºæ™¯æ•°é‡'],
      optionalInputs: ['åœºæ™¯æ ‡é¢˜', 'è§’è‰²å°è¯']
    },
    basePrompt: `A modern tutorial infographic showing advanced AI canvas workflow for sequential Pixar-style cinematic story scene generation. Dark gradient background with glowing purple and cyan neon accents. The image displays a complete creative workflow.

LEFT SECTION "è§’è‰²åˆ›å»º": Shows {{CHARACTER_COUNT}} Pixar-style cinematic 3D character cards with dramatic lighting - {{CHARACTER_DESCRIPTIONS}} - each character in glowing card frames, title label "ç¬¬ä¸€æ­¥ï¼šç”Ÿæˆè§’è‰² é€‰æ‹©ä¸»è§’".

MIDDLE SECTION "æ•…äº‹è¾“å…¥": Shows the selected character images connected with glowing cyan flow lines to a central glowing AI agent node icon, below it a text input panel clearly displaying the complete story prompt "{{STORY_PROMPT}}", and text requirement "{{TEXT_REQUIREMENT}}", title label "ç¬¬äºŒæ­¥ï¼šè¾“å…¥æ•…äº‹ä¸æ–‡å­—è¦æ±‚".

RIGHT SECTION "æˆå“å‘ˆç°": Shows exactly {{SCENE_COUNT}} sequential Pixar-style cinematic story scene images in a horizontal filmstrip layout, all featuring the same characters in consistent Pixar cinematic style with dramatic film lighting and epic composition. {{SCENE_DESCRIPTIONS}}. Title label "ç¬¬ä¸‰æ­¥ï¼šè¿è´¯åœºæ™¯ç”Ÿæˆ".

All Chinese text must be exactly as specified with no other text. Bottom banner reads "{{FOOTER_TEXT}}". Clean modern UI design, glassmorphism style, Pixar cinematic animation aesthetic with dramatic lighting and epic scale, professional product illustration, 8K resolution.`,
    variables: [
      {
        name: 'CHARACTER_COUNT',
        description: 'è§’è‰²æ•°é‡',
        type: 'text',
        required: true,
        examples: ['3', '2', '4']
      },
      {
        name: 'CHARACTER_DESCRIPTIONS',
        description: 'è§’è‰²è¯¦ç»†æè¿°',
        type: 'list',
        required: true,
        examples: ['a determined young astronaut girl with short black hair named æ˜Ÿæ²³, a weathered robot companion named é”ˆé“']
      },
      {
        name: 'STORY_PROMPT',
        description: 'æ•…äº‹æ¢—æ¦‚',
        type: 'text',
        required: true,
        examples: ['äººç±»æ–‡æ˜æ¶ˆäº¡åƒå¹´åï¼Œå°‘å¥³æ˜Ÿæ²³åœ¨åºŸå¢Ÿä¸­è¢«å”¤é†’...']
      },
      {
        name: 'TEXT_REQUIREMENT',
        description: 'æ–‡å­—æ˜¾ç¤ºè¦æ±‚',
        type: 'text',
        required: false,
        defaultValue: 'æ¯å¼ å›¾ç‰‡é¡¶éƒ¨æ˜¾ç¤ºåœºæ™¯æ ‡é¢˜ï¼Œåº•éƒ¨æ˜¾ç¤ºè§’è‰²å°è¯',
        examples: ['æ¯å¼ å›¾ç‰‡é¡¶éƒ¨æ˜¾ç¤ºåœºæ™¯æ ‡é¢˜ï¼Œåº•éƒ¨æ˜¾ç¤ºè§’è‰²å°è¯']
      },
      {
        name: 'SCENE_COUNT',
        description: 'åœºæ™¯æ•°é‡',
        type: 'text',
        required: true,
        examples: ['4', '6', '3']
      },
      {
        name: 'SCENE_DESCRIPTIONS',
        description: 'å„åœºæ™¯è¯¦ç»†æè¿°',
        type: 'list',
        required: true,
        examples: ['Scene 1: æ˜Ÿæ²³ opening her eyes inside a cracked cryogenic pod, top text "è§‰é†’", bottom dialogue "æ²‰ç¡äº†å¤šä¹…..."']
      },
      {
        name: 'FOOTER_TEXT',
        description: 'åº•éƒ¨æ ‡è¯­',
        type: 'text',
        required: false,
        defaultValue: 'æ— é™ç”»å¸ƒ Â· è®©AIè®²è¿°ä½ çš„æ•…äº‹',
        examples: ['æ— é™ç”»å¸ƒ Â· è®©AIè®²è¿°ä½ çš„æ•…äº‹ Â· https://canvas.luzhipeng.com']
      }
    ],
    examples: [],
    qualityChecklist: [
      'è§’è‰²åœ¨å„åœºæ™¯ä¸­æ˜¯å¦ä¿æŒä¸€è‡´',
      'åœºæ™¯æ˜¯å¦æŒ‰å‰§æƒ…é¡ºåºæ’åˆ—',
      'æ ‡é¢˜å’Œå°è¯æ–‡å­—æ˜¯å¦æ­£ç¡®æ˜¾ç¤º',
      'çš®å…‹æ–¯åŠ¨ç”»é£æ ¼æ˜¯å¦åˆ°ä½',
      'å…‰å½±æ•ˆæœæ˜¯å¦æœ‰ç”µå½±æ„Ÿ'
    ],
    commonIssues: [
      {
        issue: 'è§’è‰²åœ¨ä¸åŒåœºæ™¯ä¸­å¤–è§‚ä¸ä¸€è‡´',
        solution: 'æ›´è¯¦ç»†åœ°æè¿°è§’è‰²å›ºå®šç‰¹å¾',
        promptFix: 'maintaining exact same character design, clothing, and proportions across all scenes'
      },
      {
        issue: 'åœºæ™¯æ–‡å­—æ˜¾ç¤ºé”™è¯¯',
        solution: 'æ˜ç¡®æŒ‡å®šæ–‡å­—ä½ç½®å’Œå†…å®¹',
        promptFix: 'with text exactly positioned at top center for title and bottom center for dialogue'
      }
    ]
  },

  // ========== æŠ€èƒ½4: PPTç”Ÿæˆ ==========
  'ppt-generator': {
    metadata: {
      id: 'ppt-generator',
      name: 'PPTæ¼”ç¤ºæ–‡ç¨¿ç”Ÿæˆ',
      description: 'ç”Ÿæˆä¸“ä¸šçš„PPTæ¼”ç¤ºæ–‡ç¨¿è®¾è®¡å›¾ï¼ŒåŒ…å«å¤šé¡µå¹»ç¯ç‰‡é¢„è§ˆ',
      keywords: ['PPT', 'æ¼”ç¤ºæ–‡ç¨¿', 'å¹»ç¯ç‰‡', 'æ±‡æŠ¥', 'å‘å¸ƒä¼š', 'å•†åŠ¡æ¼”ç¤º', 'å¹´åº¦æŠ¥å‘Š'],
      category: 'data-visualization',
      difficulty: 'medium',
      requiredInputs: ['PPTä¸»é¢˜', 'é¡µé¢å†…å®¹åˆ—è¡¨'],
      optionalInputs: ['é£æ ¼åå¥½', 'é¢œè‰²ä¸»é¢˜']
    },
    basePrompt: `A modern tutorial infographic showing AI canvas workflow for professional PPT presentation generation. Dark gradient background with glowing purple and cyan neon accents. The image displays a complete creative workflow.

LEFT SECTION "è¾“å…¥éœ€æ±‚": Shows a text input panel with glowing border, clearly displaying the complete prompt "{{USER_REQUIREMENT}}", title label "ç¬¬ä¸€æ­¥ï¼šæè¿°ä½ çš„PPTéœ€æ±‚".

MIDDLE SECTION "æ™ºèƒ½ç”Ÿæˆ": Shows an AI agent node with magical processing particles and light beams, multiple content cards being generated and flowing outward showing outline structure, title label "ç¬¬äºŒæ­¥ï¼šAIè‡ªåŠ¨è§„åˆ’ç»“æ„ä¸å†…å®¹".

RIGHT SECTION "æˆå“å‘ˆç°": Shows exactly {{SLIDE_COUNT}} professional PPT slide previews in a cascading elegant layout, all in consistent modern tech style with {{STYLE_DESCRIPTION}}. {{SLIDES_CONTENT}}. Title label "ç¬¬ä¸‰æ­¥ï¼šä¸“ä¸šPPTä¸€é”®ç”Ÿæˆ".

All Chinese text must be exactly as specified with no other text. Bottom banner reads "{{FOOTER_TEXT}}". Clean modern UI design, glassmorphism style, professional product illustration, 8K resolution.`,
    variables: [
      {
        name: 'USER_REQUIREMENT',
        description: 'ç”¨æˆ·çš„PPTéœ€æ±‚æè¿°',
        type: 'text',
        required: true,
        examples: ['ä¸ºç§‘æŠ€å…¬å¸å¹´åº¦å‘å¸ƒä¼šåˆ¶ä½œä¸€ä»½äº§å“å‘å¸ƒPPTï¼Œä¸»é¢˜æ˜¯æ™ºèƒ½å®¶å±…æ–°å“å‘å¸ƒ']
      },
      {
        name: 'SLIDE_COUNT',
        description: 'å¹»ç¯ç‰‡æ•°é‡',
        type: 'text',
        required: true,
        examples: ['5', '6', '4']
      },
      {
        name: 'STYLE_DESCRIPTION',
        description: 'é£æ ¼æè¿°',
        type: 'text',
        required: false,
        defaultValue: 'dark blue gradient backgrounds and cyan accent lighting',
        examples: ['dark blue gradient backgrounds and cyan accent lighting', 'minimalist white background with gold accents']
      },
      {
        name: 'SLIDES_CONTENT',
        description: 'å„å¹»ç¯ç‰‡å†…å®¹æè¿°',
        type: 'list',
        required: true,
        examples: ['Slide 1: Title slide with large text "æ™ºé¢†æœªæ¥" as main title. Slide 2: Company intro slide with title "å…³äºæˆ‘ä»¬"']
      },
      {
        name: 'FOOTER_TEXT',
        description: 'åº•éƒ¨æ ‡è¯­',
        type: 'text',
        required: false,
        defaultValue: 'æ— é™ç”»å¸ƒ Â· AIè®©æ¼”ç¤ºæ›´ä¸“ä¸š',
        examples: ['æ— é™ç”»å¸ƒ Â· AIè®©æ¼”ç¤ºæ›´ä¸“ä¸š Â· https://canvas.luzhipeng.com']
      }
    ],
    examples: [],
    qualityChecklist: [
      'å¹»ç¯ç‰‡æ ‡é¢˜æ˜¯å¦æ¸…æ™°å¯è¯»',
      'å†…å®¹å±‚æ¬¡æ˜¯å¦åˆ†æ˜',
      'è®¾è®¡é£æ ¼æ˜¯å¦ç»Ÿä¸€',
      'é¢œè‰²æ­é…æ˜¯å¦åè°ƒ',
      'æ•´ä½“å¸ƒå±€æ˜¯å¦ä¸“ä¸š'
    ],
    commonIssues: [
      {
        issue: 'å¹»ç¯ç‰‡å†…å®¹è¿‡äºæ‹¥æŒ¤',
        solution: 'å‡å°‘æ¯é¡µå†…å®¹é‡',
        promptFix: 'with minimal text and generous white space on each slide'
      },
      {
        issue: 'è®¾è®¡é£æ ¼ä¸ç»Ÿä¸€',
        solution: 'å¼ºè°ƒä¸€è‡´æ€§',
        promptFix: 'maintaining exact same design language, fonts, and color scheme across all slides'
      }
    ]
  },

  // ========== æŠ€èƒ½5: æ¶æ„å›¾ ==========
  'architecture-diagram': {
    metadata: {
      id: 'architecture-diagram',
      name: 'æŠ€æœ¯æ¶æ„å›¾ç”Ÿæˆ',
      description: 'ç”Ÿæˆæ¸…æ™°çš„æŠ€æœ¯æ¶æ„å›¾ï¼Œåˆ†å±‚å±•ç¤ºç³»ç»Ÿç»“æ„',
      keywords: ['æ¶æ„å›¾', 'ç³»ç»Ÿæ¶æ„', 'æŠ€æœ¯æ¶æ„', 'åˆ†å±‚æ¶æ„', 'å¾®æœåŠ¡', 'ç³»ç»Ÿè®¾è®¡', 'æŠ€æœ¯æ–‡æ¡£'],
      category: 'architecture',
      difficulty: 'medium',
      requiredInputs: ['æ¶æ„å±‚çº§', 'å„å±‚ç»„ä»¶'],
      optionalInputs: ['é¢œè‰²ä¸»é¢˜', 'è¿æ¥å…³ç³»']
    },
    basePrompt: `A modern tutorial infographic showing AI canvas workflow for enterprise architecture diagram generation. Dark gradient background with glowing purple and cyan neon accents. The image displays a complete creative workflow.

LEFT SECTION "è¾“å…¥éœ€æ±‚": Shows a text input panel with glowing border, clearly displaying the complete prompt "{{USER_REQUIREMENT}}", title label "ç¬¬ä¸€æ­¥ï¼šæè¿°ä½ çš„æ¶æ„å›¾éœ€æ±‚".

MIDDLE SECTION "æ™ºèƒ½è§£æ": Shows an AI agent node with magical processing particles, title label "ç¬¬äºŒæ­¥ï¼šAIè§£ææ¶æ„å±‚çº§".

RIGHT SECTION "æˆå“å‘ˆç°": Shows a complete professional {{LAYER_COUNT}}-layer architecture diagram with large spacing between layers, dark background with glowing borders, each layer is a wide rounded rectangle container with colored left border:

{{LAYERS_CONTENT}}

Vertical flowing arrows connecting each layer from top to bottom. All boxes have generous padding and clear readable text. Title label "ç¬¬ä¸‰æ­¥ï¼šä¸“ä¸šæ¶æ„å›¾ä¸€é”®ç”Ÿæˆ".

All Chinese text must be exactly as specified with no other text. Bottom banner reads "{{FOOTER_TEXT}}". Clean modern UI design, glassmorphism style, 8K resolution.`,
    variables: [
      {
        name: 'USER_REQUIREMENT',
        description: 'ç”¨æˆ·çš„æ¶æ„å›¾éœ€æ±‚',
        type: 'text',
        required: true,
        examples: ['ç»˜åˆ¶ä¸€ä¸ªç”µå•†å¹³å°æŠ€æœ¯æ¶æ„å›¾ï¼ŒåŒ…å«ç”¨æˆ·ç«¯ã€ç½‘å…³å±‚ã€ä¸šåŠ¡å±‚ã€æ•°æ®å±‚ã€åŸºç¡€è®¾æ–½å±‚']
      },
      {
        name: 'LAYER_COUNT',
        description: 'æ¶æ„å±‚æ•°',
        type: 'text',
        required: true,
        examples: ['5', '4', '6']
      },
      {
        name: 'LAYERS_CONTENT',
        description: 'å„å±‚å†…å®¹æè¿°',
        type: 'list',
        required: true,
        examples: ['LAYER 1 (top layer, orange left border) - Title "ç”¨æˆ·æ¥å…¥å±‚": Contains 4 large boxes: "iOS APP", "Android APP", "å°ç¨‹åº", "PCç½‘é¡µ".']
      },
      {
        name: 'FOOTER_TEXT',
        description: 'åº•éƒ¨æ ‡è¯­',
        type: 'text',
        required: false,
        defaultValue: 'æ— é™ç”»å¸ƒ Â· AIè®©æ¶æ„æ›´æ¸…æ™°',
        examples: ['æ— é™ç”»å¸ƒ Â· AIè®©æ¶æ„æ›´æ¸…æ™° Â· https://canvas.luzhipeng.com']
      }
    ],
    examples: [],
    qualityChecklist: [
      'å±‚çº§å…³ç³»æ˜¯å¦æ¸…æ™°',
      'ç»„ä»¶åç§°æ˜¯å¦æ­£ç¡®æ˜¾ç¤º',
      'è¿æ¥ç®­å¤´æ˜¯å¦æ­£ç¡®',
      'é¢œè‰²ç¼–ç æ˜¯å¦ä¸€è‡´',
      'æ•´ä½“å¸ƒå±€æ˜¯å¦å¹³è¡¡'
    ],
    commonIssues: [
      {
        issue: 'å±‚çº§ä¹‹é—´é—´è·ä¸è¶³',
        solution: 'å¢åŠ å±‚çº§é—´è·',
        promptFix: 'with generous vertical spacing between layers (at least 50px visual gap)'
      },
      {
        issue: 'ç»„ä»¶æ¡†å¤ªå°',
        solution: 'å¢å¤§ç»„ä»¶æ¡†å°ºå¯¸',
        promptFix: 'with large component boxes that have clear padding around text'
      }
    ]
  },

  // ========== æŠ€èƒ½6: æ—…è¡Œæ”»ç•¥ ==========
  'travel-itinerary': {
    metadata: {
      id: 'travel-itinerary',
      name: 'æ—…è¡Œæ”»ç•¥å¯è§†åŒ–',
      description: 'ç”Ÿæˆç²¾ç¾çš„æ—…è¡Œè¡Œç¨‹å¯è§†åŒ–å›¾ï¼ŒåŒ…å«æ¯æ—¥å®‰æ’å’Œé¢„ç®—',
      keywords: ['æ—…è¡Œ', 'æ”»ç•¥', 'è¡Œç¨‹', 'æ—…æ¸¸', 'å‡ºè¡Œè®¡åˆ’', 'æ¯æ—¥å®‰æ’', 'æ—…è¡Œé¢„ç®—'],
      category: 'lifestyle',
      difficulty: 'medium',
      requiredInputs: ['ç›®çš„åœ°', 'å¤©æ•°', 'æ¯æ—¥è¡Œç¨‹'],
      optionalInputs: ['é¢„ç®—', 'åå¥½']
    },
    basePrompt: `A modern tutorial infographic showing AI canvas workflow for travel itinerary visual guide generation. Dark gradient background with glowing purple and cyan neon accents. The image displays a complete creative workflow.

LEFT SECTION "è¾“å…¥éœ€æ±‚": Shows a text input panel with glowing border, clearly displaying the complete prompt "{{USER_REQUIREMENT}}", title label "ç¬¬ä¸€æ­¥ï¼šæè¿°ä½ çš„æ—…è¡Œè®¡åˆ’".

MIDDLE SECTION "æ™ºèƒ½è§„åˆ’": Shows an AI agent node with magical processing particles, travel-related icons floating around like plane, map pin, food, camera, title label "ç¬¬äºŒæ­¥ï¼šAIæ™ºèƒ½è§„åˆ’è¡Œç¨‹".

RIGHT SECTION "æˆå“å‘ˆç°": Shows a beautiful visual travel itinerary with {{DAY_COUNT}} day cards arranged horizontally, each card has consistent modern design with dark background and gradient colored top border, containing timeline and details:

{{DAYS_CONTENT}}

Below the day cards, a summary bar showing "{{SUMMARY_TEXT}}".

Title label "ç¬¬ä¸‰æ­¥ï¼šå¯è§†åŒ–è¡Œç¨‹ä¸€é”®ç”Ÿæˆ".

All Chinese text must be exactly as specified with no other text. Bottom banner reads "{{FOOTER_TEXT}}". Clean modern UI design, glassmorphism style, professional product illustration, 8K resolution.`,
    variables: [
      {
        name: 'USER_REQUIREMENT',
        description: 'ç”¨æˆ·çš„æ—…è¡Œéœ€æ±‚',
        type: 'text',
        required: true,
        examples: ['è®¡åˆ’å›½åº†å»æˆéƒ½æ—…è¡Œï¼Œ4å¤©3æ™šï¼Œé¢„ç®—5000å…ƒï¼Œä¸¤ä¸ªäºº']
      },
      {
        name: 'DAY_COUNT',
        description: 'å¤©æ•°',
        type: 'text',
        required: true,
        examples: ['4', '3', '5']
      },
      {
        name: 'DAYS_CONTENT',
        description: 'æ¯æ—¥è¡Œç¨‹å†…å®¹',
        type: 'list',
        required: true,
        examples: ['DAY CARD 1 (orange top border) - Header "Day 1 Â· åˆè§æˆéƒ½": Timeline shows "14:00 æŠµè¾¾åŒæµæœºåœº", "15:30 å…¥ä½å¤ªå¤é‡Œæ°‘å®¿"...']
      },
      {
        name: 'SUMMARY_TEXT',
        description: 'æ€»ç»“ä¿¡æ¯',
        type: 'text',
        required: false,
        examples: ['æ€»é¢„ç®—ï¼š2400å…ƒ Â· å‰©ä½™ï¼š2600å…ƒ Â· äººå‡ï¼š1200å…ƒ']
      },
      {
        name: 'FOOTER_TEXT',
        description: 'åº•éƒ¨æ ‡è¯­',
        type: 'text',
        required: false,
        defaultValue: 'æ— é™ç”»å¸ƒ Â· AIè®©æ—…è¡Œæ›´ç²¾å½©',
        examples: ['æ— é™ç”»å¸ƒ Â· AIè®©æ—…è¡Œæ›´ç²¾å½© Â· https://canvas.luzhipeng.com']
      }
    ],
    examples: [],
    qualityChecklist: [
      'æ—¥æœŸå¡ç‰‡æ˜¯å¦æ’åˆ—æ•´é½',
      'æ—¶é—´çº¿æ˜¯å¦æ¸…æ™°',
      'åœ°ç‚¹åç§°æ˜¯å¦æ­£ç¡®',
      'é¢„ç®—ä¿¡æ¯æ˜¯å¦å‡†ç¡®',
      'æ•´ä½“è®¾è®¡æ˜¯å¦ç¾è§‚'
    ],
    commonIssues: [
      {
        issue: 'æ—¶é—´çº¿æ¡ç›®è¿‡å¤š',
        solution: 'ç²¾ç®€æ¯æ—¥æ´»åŠ¨æ•°é‡',
        promptFix: 'with maximum 5-6 timeline items per day card'
      }
    ]
  },

  // ========== æŠ€èƒ½7: å®¶åº­è®°è´¦ ==========
  'budget-visualization': {
    metadata: {
      id: 'budget-visualization',
      name: 'å®¶åº­è®°è´¦å¯è§†åŒ–',
      description: 'ç”Ÿæˆå®¶åº­æ”¶æ”¯å¯è§†åŒ–å›¾è¡¨ï¼ŒåŒ…å«é¥¼å›¾ã€æŸ±çŠ¶å›¾ç­‰æ•°æ®å±•ç¤º',
      keywords: ['è®°è´¦', 'è´¦å•', 'æ”¶æ”¯', 'é¢„ç®—', 'è´¢åŠ¡', 'å®¶åº­å¼€é”€', 'æ•°æ®å›¾è¡¨', 'å¯è§†åŒ–'],
      category: 'data-visualization',
      difficulty: 'medium',
      requiredInputs: ['æ”¶å…¥', 'æ”¯å‡ºæ˜ç»†'],
      optionalInputs: ['æ—¶é—´èŒƒå›´', 'åˆ†æå»ºè®®']
    },
    basePrompt: `A modern tutorial infographic showing AI canvas workflow for family budget visualization generation. Dark gradient background with glowing purple and cyan neon accents. The image displays a complete creative workflow.

LEFT SECTION "è¾“å…¥éœ€æ±‚": Shows a text input panel with glowing border, clearly displaying the complete prompt "{{USER_REQUIREMENT}}", title label "ç¬¬ä¸€æ­¥ï¼šè¾“å…¥æ”¶æ”¯æ˜ç»†".

MIDDLE SECTION "æ™ºèƒ½åˆ†æ": Shows an AI agent node with magical processing particles and chart icons floating around, title label "ç¬¬äºŒæ­¥ï¼šAIæ™ºèƒ½åˆ†æ".

RIGHT SECTION "æˆå“å‘ˆç°": Shows a beautiful financial dashboard with dark background containing {{CHART_COUNT}} visual elements:

{{CHARTS_CONTENT}}

Title label "ç¬¬ä¸‰æ­¥ï¼šå¯è§†åŒ–è´¦å•ä¸€é”®ç”Ÿæˆ".

All Chinese text must be exactly as specified with no other text. Bottom banner reads "{{FOOTER_TEXT}}". Clean modern UI design, glassmorphism style, 8K resolution.`,
    variables: [
      {
        name: 'USER_REQUIREMENT',
        description: 'ç”¨æˆ·çš„è®°è´¦éœ€æ±‚',
        type: 'text',
        required: true,
        examples: ['å¸®æˆ‘ç”Ÿæˆ11æœˆå®¶åº­è´¦å•å¯è§†åŒ–å›¾è¡¨ï¼Œæ”¶å…¥15000å…ƒï¼Œæˆ¿è´·5500å…ƒï¼Œé¤é¥®2800å…ƒ...']
      },
      {
        name: 'CHART_COUNT',
        description: 'å›¾è¡¨æ•°é‡',
        type: 'text',
        required: true,
        examples: ['4', '3']
      },
      {
        name: 'CHARTS_CONTENT',
        description: 'å„å›¾è¡¨å†…å®¹æè¿°',
        type: 'list',
        required: true,
        examples: ['ELEMENT 1 (top left): A summary card with title "11æœˆå®¶åº­è´¦å•" showing "æ€»æ”¶å…¥ï¼š15000å…ƒ" in green text...']
      },
      {
        name: 'FOOTER_TEXT',
        description: 'åº•éƒ¨æ ‡è¯­',
        type: 'text',
        required: false,
        defaultValue: 'æ— é™ç”»å¸ƒ Â· AIè®©ç”Ÿæ´»æ›´æ¸…æ™°',
        examples: ['æ— é™ç”»å¸ƒ Â· AIè®©ç”Ÿæ´»æ›´æ¸…æ™° Â· https://canvas.luzhipeng.com']
      }
    ],
    examples: [],
    qualityChecklist: [
      'æ•°æ®æ˜¯å¦å‡†ç¡®æ˜¾ç¤º',
      'å›¾è¡¨ç±»å‹æ˜¯å¦åˆé€‚',
      'é¢œè‰²ç¼–ç æ˜¯å¦æ¸…æ™°',
      'ç™¾åˆ†æ¯”è®¡ç®—æ˜¯å¦æ­£ç¡®',
      'æ•´ä½“å¸ƒå±€æ˜¯å¦å¹³è¡¡'
    ],
    commonIssues: [
      {
        issue: 'é¥¼å›¾æ ‡ç­¾é‡å ',
        solution: 'ä½¿ç”¨å›¾ä¾‹ä»£æ›¿ç›´æ¥æ ‡ç­¾',
        promptFix: 'with legend on the side instead of labels on pie slices'
      }
    ]
  }
};
```

---

## ä¸‰ã€å·¥å…·å®šä¹‰ (Tools Definition)

### 3.1 å·¥å…·ç±»å‹å®šä¹‰

```typescript
// src/types/super-agent.ts

export interface AgentTool {
  name: string;
  description: string;
  parameters: ToolParameter[];
  handler: (params: Record<string, any>) => Promise<ToolResult>;
}

export interface ToolParameter {
  name: string;
  type: 'string' | 'number' | 'boolean' | 'array' | 'object';
  description: string;
  required: boolean;
  enum?: string[];
}

export interface ToolResult {
  success: boolean;
  data?: any;
  error?: string;
  shouldContinue: boolean;  // æ˜¯å¦éœ€è¦ç»§ç»­ ReAct å¾ªç¯
}
```

### 3.2 æ ¸å¿ƒå·¥å…·é›†

```typescript
// src/lib/super-agent/tools.ts

export const SUPER_AGENT_TOOLS: AgentTool[] = [

  // ========== å·¥å…·1: æŠ€èƒ½åŒ¹é…å™¨ ==========
  {
    name: 'skill_matcher',
    description: 'åˆ†æç”¨æˆ·éœ€æ±‚ï¼ŒåŒ¹é…æœ€åˆé€‚çš„é¢„è®¾æŠ€èƒ½ã€‚å¦‚æœæ²¡æœ‰åŒ¹é…çš„æŠ€èƒ½ï¼Œè¿”å› null è¡¨ç¤ºéœ€è¦è‡ªä¸»ç”Ÿæˆã€‚',
    parameters: [
      {
        name: 'user_request',
        type: 'string',
        description: 'ç”¨æˆ·çš„åŸå§‹éœ€æ±‚æè¿°',
        required: true
      },
      {
        name: 'reference_image_analysis',
        type: 'string',
        description: 'å‚è€ƒå›¾ç‰‡çš„åˆ†æç»“æœï¼ˆå¦‚æœæœ‰ï¼‰',
        required: false
      }
    ],
    handler: async (params) => {
      // å®ç°æŠ€èƒ½åŒ¹é…é€»è¾‘
      const { user_request, reference_image_analysis } = params;

      // éå†æŠ€èƒ½åº“ï¼Œè®¡ç®—åŒ¹é…åˆ†æ•°
      const scores = Object.entries(SKILL_LIBRARY).map(([id, skill]) => {
        let score = 0;
        const keywords = skill.metadata.keywords;

        keywords.forEach(keyword => {
          if (user_request.includes(keyword)) {
            score += 10;
          }
        });

        // å¦‚æœæœ‰å‚è€ƒå›¾åˆ†æï¼Œè¿›ä¸€æ­¥åŒ¹é…
        if (reference_image_analysis) {
          keywords.forEach(keyword => {
            if (reference_image_analysis.includes(keyword)) {
              score += 5;
            }
          });
        }

        return { id, skill, score };
      });

      // æ’åºå¹¶è¿”å›æœ€ä½³åŒ¹é…
      scores.sort((a, b) => b.score - a.score);

      if (scores[0].score >= 10) {
        return {
          success: true,
          data: {
            matched_skill: scores[0].id,
            confidence: Math.min(scores[0].score / 50, 1),
            all_matches: scores.slice(0, 3).map(s => ({
              id: s.id,
              name: s.skill.metadata.name,
              score: s.score
            }))
          },
          shouldContinue: true
        };
      }

      return {
        success: true,
        data: { matched_skill: null, reason: 'æ²¡æœ‰åŒ¹é…çš„é¢„è®¾æŠ€èƒ½ï¼Œå°†è‡ªä¸»ç”Ÿæˆ' },
        shouldContinue: true
      };
    }
  },

  // ========== å·¥å…·2: æŠ€èƒ½åŠ è½½å™¨ ==========
  {
    name: 'load_skill',
    description: 'åŠ è½½æŒ‡å®šæŠ€èƒ½çš„å®Œæ•´å†…å®¹ï¼ŒåŒ…æ‹¬æ¨¡æ¿ã€å˜é‡å®šä¹‰ã€ç¤ºä¾‹å’Œå¸¸è§é—®é¢˜è§£å†³æ–¹æ¡ˆã€‚',
    parameters: [
      {
        name: 'skill_id',
        type: 'string',
        description: 'æŠ€èƒ½ID',
        required: true
      }
    ],
    handler: async (params) => {
      const skill = SKILL_LIBRARY[params.skill_id];
      if (!skill) {
        return {
          success: false,
          error: `æŠ€èƒ½ ${params.skill_id} ä¸å­˜åœ¨`,
          shouldContinue: false
        };
      }

      return {
        success: true,
        data: skill,
        shouldContinue: true
      };
    }
  },

  // ========== å·¥å…·3: æç¤ºè¯ç”Ÿæˆå™¨ ==========
  {
    name: 'generate_prompt',
    description: 'æ ¹æ®ç”¨æˆ·éœ€æ±‚å’ŒæŠ€èƒ½æ¨¡æ¿ï¼Œç”Ÿæˆå®Œæ•´çš„æç¤ºè¯ã€‚å¦‚æœæ²¡æœ‰åŒ¹é…æŠ€èƒ½ï¼Œåˆ™è‡ªä¸»åˆ›ä½œã€‚',
    parameters: [
      {
        name: 'user_request',
        type: 'string',
        description: 'ç”¨æˆ·åŸå§‹éœ€æ±‚',
        required: true
      },
      {
        name: 'skill_template',
        type: 'object',
        description: 'æŠ€èƒ½æ¨¡æ¿ï¼ˆå¦‚æœæœ‰ï¼‰',
        required: false
      },
      {
        name: 'variables',
        type: 'object',
        description: 'å˜é‡å¡«å……å€¼',
        required: false
      },
      {
        name: 'reference_analysis',
        type: 'string',
        description: 'å‚è€ƒå›¾åˆ†æç»“æœ',
        required: false
      }
    ],
    handler: async (params) => {
      // è¿™ä¸ªå·¥å…·çš„å®é™…é€»è¾‘ç”± Claude æ‰§è¡Œ
      // è¿™é‡Œåªæ˜¯ç»“æ„å®šä¹‰
      return {
        success: true,
        data: {
          prompt_v1: '',  // Claude ä¼šå¡«å……
          chinese_texts: [],
          generation_notes: ''
        },
        shouldContinue: true
      };
    }
  },

  // ========== å·¥å…·4: ç½‘ç»œæœç´¢ ==========
  {
    name: 'web_search',
    description: 'æœç´¢ç½‘ç»œè·å–æœ€æ–°çš„æç¤ºè¯æŠ€å·§ã€é£æ ¼å‚è€ƒã€æœ€ä½³å®è·µç­‰ä¿¡æ¯ã€‚å½“éœ€è¦äº†è§£æœ€æ–°è¶‹åŠ¿æˆ–è§£å†³ç‰¹å®šé—®é¢˜æ—¶ä½¿ç”¨ã€‚',
    parameters: [
      {
        name: 'query',
        type: 'string',
        description: 'æœç´¢æŸ¥è¯¢',
        required: true
      },
      {
        name: 'search_type',
        type: 'string',
        description: 'æœç´¢ç±»å‹',
        required: true,
        enum: ['prompt_techniques', 'style_reference', 'problem_solving', 'trend_research']
      }
    ],
    handler: async (params) => {
      // è°ƒç”¨å®é™…çš„æœç´¢ API
      // è¿™é‡Œæ˜¯ç»“æ„å®šä¹‰
      return {
        success: true,
        data: {
          results: [],
          summary: ''
        },
        shouldContinue: true
      };
    }
  },

  // ========== å·¥å…·5: å›¾ç‰‡åˆ†æ ==========
  {
    name: 'analyze_image',
    description: 'åˆ†æå‚è€ƒå›¾ç‰‡ï¼Œæå–é£æ ¼ç‰¹å¾ã€å¸ƒå±€ç»“æ„ã€é¢œè‰²æ–¹æ¡ˆç­‰ä¿¡æ¯ã€‚',
    parameters: [
      {
        name: 'image_url',
        type: 'string',
        description: 'å›¾ç‰‡URL',
        required: true
      },
      {
        name: 'analysis_focus',
        type: 'array',
        description: 'åˆ†æé‡ç‚¹',
        required: false
      }
    ],
    handler: async (params) => {
      // è°ƒç”¨ Claude Vision API
      return {
        success: true,
        data: {
          style: '',
          layout: '',
          colors: [],
          elements: [],
          suggestions: []
        },
        shouldContinue: true
      };
    }
  },

  // ========== å·¥å…·6: æç¤ºè¯ä¼˜åŒ– ==========
  {
    name: 'optimize_prompt',
    description: 'æ ¹æ®è¯„ä¼°ç»“æœæˆ–æœç´¢åˆ°çš„æŠ€å·§ï¼Œä¼˜åŒ–ç°æœ‰æç¤ºè¯ã€‚',
    parameters: [
      {
        name: 'current_prompt',
        type: 'string',
        description: 'å½“å‰æç¤ºè¯',
        required: true
      },
      {
        name: 'issues',
        type: 'array',
        description: 'éœ€è¦è§£å†³çš„é—®é¢˜åˆ—è¡¨',
        required: false
      },
      {
        name: 'optimization_tips',
        type: 'array',
        description: 'ä¼˜åŒ–æŠ€å·§',
        required: false
      },
      {
        name: 'iteration',
        type: 'number',
        description: 'å½“å‰è¿­ä»£æ¬¡æ•°',
        required: true
      }
    ],
    handler: async (params) => {
      return {
        success: true,
        data: {
          optimized_prompt: '',
          changes_made: [],
          version: params.iteration + 1
        },
        shouldContinue: true
      };
    }
  },

  // ========== å·¥å…·7: è´¨é‡è¯„ä¼° ==========
  {
    name: 'evaluate_prompt',
    description: 'è¯„ä¼°æç¤ºè¯è´¨é‡ï¼Œæ£€æŸ¥æ˜¯å¦æ»¡è¶³æ‰€æœ‰è¦æ±‚ã€‚',
    parameters: [
      {
        name: 'prompt',
        type: 'string',
        description: 'å¾…è¯„ä¼°çš„æç¤ºè¯',
        required: true
      },
      {
        name: 'user_requirements',
        type: 'string',
        description: 'ç”¨æˆ·åŸå§‹éœ€æ±‚',
        required: true
      },
      {
        name: 'chinese_texts',
        type: 'array',
        description: 'éœ€è¦æ˜¾ç¤ºçš„ä¸­æ–‡æ–‡å­—åˆ—è¡¨',
        required: true
      },
      {
        name: 'skill_checklist',
        type: 'array',
        description: 'æŠ€èƒ½è´¨é‡æ£€æŸ¥æ¸…å•',
        required: false
      }
    ],
    handler: async (params) => {
      return {
        success: true,
        data: {
          score: 0,  // 0-100
          passed: false,
          issues: [],
          suggestions: []
        },
        shouldContinue: true  // å¦‚æœåˆ†æ•°ä¸å¤Ÿï¼Œç»§ç»­ä¼˜åŒ–
      };
    }
  },

  // ========== å·¥å…·8: æœ€ç»ˆè¾“å‡º ==========
  {
    name: 'finalize_output',
    description: 'å½“æç¤ºè¯è¾¾åˆ°è´¨é‡è¦æ±‚æ—¶ï¼Œè¾“å‡ºæœ€ç»ˆç»“æœã€‚',
    parameters: [
      {
        name: 'final_prompt',
        type: 'string',
        description: 'æœ€ç»ˆæç¤ºè¯',
        required: true
      },
      {
        name: 'chinese_texts',
        type: 'array',
        description: 'ä¸­æ–‡æ–‡å­—æ¸…å•',
        required: true
      },
      {
        name: 'generation_tips',
        type: 'array',
        description: 'ç”Ÿæˆå»ºè®®',
        required: false
      },
      {
        name: 'recommended_model',
        type: 'string',
        description: 'æ¨èçš„ç”Ÿæˆæ¨¡å‹',
        required: false
      }
    ],
    handler: async (params) => {
      return {
        success: true,
        data: params,
        shouldContinue: false  // ç»“æŸ ReAct å¾ªç¯
      };
    }
  }
];
```

---

## å››ã€ReAct å¾ªç¯å®ç°

### 4.1 æ ¸å¿ƒç³»ç»Ÿæç¤ºè¯

```typescript
// src/lib/super-agent/system-prompt.ts

export const SUPER_AGENT_SYSTEM_PROMPT = `ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„ AI ç»˜å›¾æç¤ºè¯ä¸“å®¶ï¼Œé‡‡ç”¨ ReActï¼ˆæ¨ç†-è¡ŒåŠ¨ï¼‰ç­–ç•¥æ¥å®Œæˆä»»åŠ¡ã€‚

## ä½ çš„æ ¸å¿ƒèƒ½åŠ›

1. **æŠ€èƒ½åŒ¹é…**ï¼šè¯†åˆ«ç”¨æˆ·éœ€æ±‚ï¼ŒåŒ¹é…é¢„è®¾çš„æç¤ºè¯æŠ€èƒ½æ¨¡æ¿
2. **è‡ªä¸»åˆ›ä½œ**ï¼šå½“æ²¡æœ‰åŒ¹é…æŠ€èƒ½æ—¶ï¼Œè‡ªä¸»åˆ›ä½œé«˜è´¨é‡æç¤ºè¯
3. **è¿­ä»£ä¼˜åŒ–**ï¼šé€šè¿‡å¤šè½®ä¼˜åŒ–ï¼Œç¡®ä¿æç¤ºè¯è´¨é‡
4. **å·¥å…·ä½¿ç”¨**ï¼šæ™ºèƒ½å†³å®šä½•æ—¶ä½¿ç”¨æœç´¢ã€å›¾ç‰‡åˆ†æç­‰å·¥å…·

## å¯ç”¨å·¥å…·

ä½ å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å·¥å…·ï¼š
- \`skill_matcher\`: åŒ¹é…é¢„è®¾æŠ€èƒ½
- \`load_skill\`: åŠ è½½æŠ€èƒ½è¯¦æƒ…
- \`generate_prompt\`: ç”Ÿæˆæç¤ºè¯
- \`web_search\`: æœç´¢æœ€ä½³å®è·µ
- \`analyze_image\`: åˆ†æå‚è€ƒå›¾ç‰‡
- \`optimize_prompt\`: ä¼˜åŒ–æç¤ºè¯
- \`evaluate_prompt\`: è¯„ä¼°è´¨é‡
- \`finalize_output\`: è¾“å‡ºæœ€ç»ˆç»“æœ

## ReAct å·¥ä½œæµç¨‹

æ¯ä¸€è½®ä½ éœ€è¦ï¼š
1. **Thought**: åˆ†æå½“å‰çŠ¶æ€ï¼Œå†³å®šä¸‹ä¸€æ­¥è¡ŒåŠ¨
2. **Action**: é€‰æ‹©å¹¶è°ƒç”¨åˆé€‚çš„å·¥å…·
3. **Observation**: è§‚å¯Ÿå·¥å…·è¿”å›ç»“æœ
4. é‡å¤ä»¥ä¸Šæ­¥éª¤ç›´åˆ°ä»»åŠ¡å®Œæˆ

## å†³ç­–æŒ‡å—

### ä½•æ—¶ä½¿ç”¨ web_search
- ç”¨æˆ·éœ€æ±‚æ¶‰åŠæœ€æ–°è¶‹åŠ¿ï¼ˆå¦‚"2024å¹´æµè¡Œé£æ ¼"ï¼‰
- é‡åˆ°ä¸ç¡®å®šçš„æŠ€æœ¯é—®é¢˜
- éœ€è¦äº†è§£ç‰¹å®šé¢†åŸŸçš„æœ€ä½³å®è·µ
- éœ€è¦å‚è€ƒçœŸå®æ¡ˆä¾‹

### ä½•æ—¶ä½¿ç”¨ analyze_image
- ç”¨æˆ·æä¾›äº†å‚è€ƒå›¾ç‰‡
- éœ€è¦å¤åˆ¶ç‰¹å®šé£æ ¼
- éœ€è¦ç†è§£å›¾ç‰‡ç»“æ„ç”¨äºé‡ç°

### ä½•æ—¶è¿›è¡Œè¿­ä»£ä¼˜åŒ–
- è¯„ä¼°åˆ†æ•°ä½äº 85 åˆ†
- å­˜åœ¨æ˜æ˜¾é—®é¢˜ï¼ˆæ–‡å­—ã€å¸ƒå±€ã€é£æ ¼ï¼‰
- ç”¨æˆ·æœ‰é¢å¤–è¦æ±‚æœªæ»¡è¶³

### ä½•æ—¶ç»“æŸ
- è¯„ä¼°åˆ†æ•° >= 85 åˆ†
- å·²è¾¾åˆ°æœ€å¤§è¿­ä»£æ¬¡æ•°ï¼ˆ5æ¬¡ï¼‰
- æ‰€æœ‰ç”¨æˆ·éœ€æ±‚éƒ½å·²æ»¡è¶³

## ä¸­æ–‡æ–‡å­—å¤„ç†è§„åˆ™ï¼ˆæœ€é‡è¦ï¼ï¼‰

1. **ä¿ç•™ä¸­æ–‡åŸæ–‡**ï¼šç”¨æˆ·éœ€è¦æ˜¾ç¤ºçš„ä¸­æ–‡å¿…é¡»åŸæ ·ä¿ç•™åœ¨æç¤ºè¯ä¸­
2. **å¼•å·åŒ…è£¹**ï¼šä¸­æ–‡æ–‡å­—å¿…é¡»ç”¨è‹±æ–‡åŒå¼•å· "" åŒ…è£¹
3. **ç¦æ­¢ç¿»è¯‘**ï¼šç»å¯¹ä¸èƒ½å°†ä¸­æ–‡ç¿»è¯‘æˆè‹±æ–‡
4. **æ˜ç¡®ä½ç½®**ï¼šæŒ‡æ˜æ–‡å­—åœ¨å›¾ç‰‡ä¸­çš„æ˜¾ç¤ºä½ç½®
5. **æ·»åŠ çº¦æŸ**ï¼šä½¿ç”¨ "All Chinese text must be exactly as specified with no other text"

### æ­£ç¡®ç¤ºä¾‹
ç”¨æˆ·éœ€æ±‚ï¼šç”Ÿæˆä¸€å¼ æµ·æŠ¥ï¼Œä¸Šé¢å†™ç€"æ–°å¹´å¿«ä¹"
âœ“ æ­£ç¡®ï¼šA vibrant poster featuring Chinese text "æ–°å¹´å¿«ä¹" displayed prominently in the center
âœ— é”™è¯¯ï¼šA vibrant poster with Happy New Year

## è¾“å‡ºæ ¼å¼

æœ€ç»ˆè¾“å‡ºå¿…é¡»åŒ…å«ï¼š
1. **è‹±æ–‡æç¤ºè¯**ï¼šå®Œæ•´çš„ã€å¯ç›´æ¥ä½¿ç”¨çš„æç¤ºè¯
2. **ä¸­æ–‡æ–‡å­—æ¸…å•**ï¼šåˆ—å‡ºæ‰€æœ‰éœ€è¦åœ¨å›¾ç‰‡ä¸­æ˜¾ç¤ºçš„ä¸­æ–‡
3. **ç”Ÿæˆå»ºè®®**ï¼šæ¨¡å‹é€‰æ‹©ã€å‚æ•°è®¾ç½®ç­‰å»ºè®®

ç°åœ¨ï¼Œè¯·æ ¹æ®ç”¨æˆ·éœ€æ±‚å¼€å§‹å·¥ä½œã€‚è®°ä½ï¼šå§‹ç»ˆä¿æŒ ReAct æ€ç»´æ¨¡å¼ï¼Œæ¯ä¸€æ­¥éƒ½è¦æ€è€ƒã€è¡ŒåŠ¨ã€è§‚å¯Ÿã€‚`;
```

### 4.2 ReAct å¾ªç¯å¤„ç†å™¨

```typescript
// src/lib/super-agent/react-loop.ts

import Anthropic from '@anthropic-ai/sdk';
import { SUPER_AGENT_TOOLS } from './tools';
import { SUPER_AGENT_SYSTEM_PROMPT } from './system-prompt';

interface ReActState {
  iteration: number;
  maxIterations: number;
  thoughtHistory: ThoughtStep[];
  currentPrompt: string | null;
  evaluationScore: number;
  isComplete: boolean;
}

interface ThoughtStep {
  thought: string;
  action: string;
  actionInput: Record<string, any>;
  observation: string;
}

export async function runReActLoop(
  userRequest: string,
  referenceImages?: string[],
  onProgress?: (step: ThoughtStep) => void
): Promise<FinalOutput> {
  const anthropic = new Anthropic();

  const state: ReActState = {
    iteration: 0,
    maxIterations: 5,
    thoughtHistory: [],
    currentPrompt: null,
    evaluationScore: 0,
    isComplete: false
  };

  // æ„å»ºåˆå§‹æ¶ˆæ¯
  let messages: Anthropic.MessageParam[] = [
    {
      role: 'user',
      content: buildInitialPrompt(userRequest, referenceImages)
    }
  ];

  // ReAct å¾ªç¯
  while (!state.isComplete && state.iteration < state.maxIterations) {
    state.iteration++;

    // è°ƒç”¨ Claude è¿›è¡Œæ¨ç†
    const response = await anthropic.messages.create({
      model: 'claude-opus-4-5-20251101',
      max_tokens: 4096,
      system: SUPER_AGENT_SYSTEM_PROMPT,
      tools: formatToolsForClaude(SUPER_AGENT_TOOLS),
      messages
    });

    // å¤„ç†å“åº”
    for (const block of response.content) {
      if (block.type === 'text') {
        // è§£æ Thought
        const thought = extractThought(block.text);
        if (thought) {
          console.log(`[Iteration ${state.iteration}] Thought: ${thought}`);
        }
      } else if (block.type === 'tool_use') {
        // æ‰§è¡Œå·¥å…·è°ƒç”¨
        const toolName = block.name;
        const toolInput = block.input as Record<string, any>;

        console.log(`[Iteration ${state.iteration}] Action: ${toolName}`);
        console.log(`[Iteration ${state.iteration}] Input:`, toolInput);

        // æ‰¾åˆ°å¹¶æ‰§è¡Œå·¥å…·
        const tool = SUPER_AGENT_TOOLS.find(t => t.name === toolName);
        if (tool) {
          const result = await tool.handler(toolInput);

          console.log(`[Iteration ${state.iteration}] Observation:`, result);

          // è®°å½•æ­¥éª¤
          const step: ThoughtStep = {
            thought: '',  // ä»å‰é¢çš„ text block è·å–
            action: toolName,
            actionInput: toolInput,
            observation: JSON.stringify(result.data)
          };
          state.thoughtHistory.push(step);

          // é€šçŸ¥è¿›åº¦
          if (onProgress) {
            onProgress(step);
          }

          // æ£€æŸ¥æ˜¯å¦å®Œæˆ
          if (toolName === 'finalize_output' && result.success) {
            state.isComplete = true;
            return result.data as FinalOutput;
          }

          // æ£€æŸ¥è¯„ä¼°åˆ†æ•°
          if (toolName === 'evaluate_prompt' && result.data?.score) {
            state.evaluationScore = result.data.score;
            if (result.data.score >= 85) {
              // åˆ†æ•°å¤Ÿäº†ï¼Œä¸‹ä¸€æ­¥åº”è¯¥æ˜¯ finalize
            }
          }

          // æ·»åŠ å·¥å…·ç»“æœåˆ°æ¶ˆæ¯
          messages.push({
            role: 'assistant',
            content: response.content
          });
          messages.push({
            role: 'user',
            content: [{
              type: 'tool_result',
              tool_use_id: block.id,
              content: JSON.stringify(result)
            }]
          });
        }
      }
    }

    // æ£€æŸ¥æ˜¯å¦éœ€è¦ç»§ç»­
    if (response.stop_reason === 'end_turn' && !state.isComplete) {
      // Claude ä¸»åŠ¨ç»“æŸä½†ä»»åŠ¡æœªå®Œæˆï¼Œå¯èƒ½éœ€è¦æç¤ºç»§ç»­
      messages.push({
        role: 'user',
        content: 'è¯·ç»§ç»­å®Œæˆä»»åŠ¡ã€‚å¦‚æœæç¤ºè¯å·²ç»è¶³å¤Ÿå¥½ï¼ˆè¯„ä¼°åˆ†æ•° >= 85ï¼‰ï¼Œè¯·ä½¿ç”¨ finalize_output å·¥å…·è¾“å‡ºæœ€ç»ˆç»“æœã€‚'
      });
    }
  }

  // è¾¾åˆ°æœ€å¤§è¿­ä»£æ¬¡æ•°
  throw new Error('è¾¾åˆ°æœ€å¤§è¿­ä»£æ¬¡æ•°ï¼Œä»»åŠ¡æœªå®Œæˆ');
}

function buildInitialPrompt(userRequest: string, referenceImages?: string[]): string {
  let prompt = `## ç”¨æˆ·éœ€æ±‚\n${userRequest}\n`;

  if (referenceImages && referenceImages.length > 0) {
    prompt += `\n## å‚è€ƒå›¾ç‰‡\nç”¨æˆ·æä¾›äº† ${referenceImages.length} å¼ å‚è€ƒå›¾ç‰‡ï¼Œè¯·å…ˆä½¿ç”¨ analyze_image å·¥å…·åˆ†æã€‚\n`;
  }

  prompt += `\nè¯·å¼€å§‹ ReAct æµç¨‹ï¼Œé¦–å…ˆæ€è€ƒåº”è¯¥å¦‚ä½•å¤„ç†è¿™ä¸ªéœ€æ±‚ã€‚`;

  return prompt;
}

function formatToolsForClaude(tools: AgentTool[]): Anthropic.Tool[] {
  return tools.map(tool => ({
    name: tool.name,
    description: tool.description,
    input_schema: {
      type: 'object' as const,
      properties: tool.parameters.reduce((acc, param) => {
        acc[param.name] = {
          type: param.type,
          description: param.description,
          ...(param.enum ? { enum: param.enum } : {})
        };
        return acc;
      }, {} as Record<string, any>),
      required: tool.parameters.filter(p => p.required).map(p => p.name)
    }
  }));
}

function extractThought(text: string): string | null {
  const match = text.match(/Thought:\s*(.+?)(?=Action:|$)/s);
  return match ? match[1].trim() : null;
}
```

---

## äº”ã€API è·¯ç”±å®ç°

### 5.1 æµå¼ API ç«¯ç‚¹

```typescript
// src/app/api/super-agent/generate/route.ts

import { NextRequest } from 'next/server';
import { runReActLoopStream } from '@/lib/super-agent/react-loop-stream';

export async function POST(request: NextRequest) {
  const encoder = new TextEncoder();

  const stream = new TransformStream();
  const writer = stream.writable.getWriter();

  const sendEvent = async (event: SuperAgentStreamEvent) => {
    await writer.write(encoder.encode(`data: ${JSON.stringify(event)}\n\n`));
  };

  (async () => {
    try {
      const body = await request.json();
      const { userRequest, referenceImages } = body;

      // å‘é€å¼€å§‹äº‹ä»¶
      await sendEvent({
        type: 'start',
        message: 'å¼€å§‹åˆ†æéœ€æ±‚...'
      });

      // è¿è¡Œ ReAct å¾ªç¯
      const result = await runReActLoopStream(
        userRequest,
        referenceImages,
        async (step) => {
          // å‘é€æ¯ä¸€æ­¥çš„è¿›åº¦
          await sendEvent({
            type: 'thought_step',
            iteration: step.iteration,
            thought: step.thought,
            action: step.action,
            actionInput: step.actionInput
          });
        },
        async (observation) => {
          // å‘é€è§‚å¯Ÿç»“æœ
          await sendEvent({
            type: 'observation',
            data: observation
          });
        }
      );

      // å‘é€å®Œæˆäº‹ä»¶
      await sendEvent({
        type: 'complete',
        result: {
          finalPrompt: result.final_prompt,
          chineseTexts: result.chinese_texts,
          generationTips: result.generation_tips,
          recommendedModel: result.recommended_model,
          iterationCount: result.iteration_count,
          matchedSkill: result.matched_skill
        }
      });

    } catch (error) {
      await sendEvent({
        type: 'error',
        error: error instanceof Error ? error.message : 'æœªçŸ¥é”™è¯¯'
      });
    } finally {
      await writer.close();
    }
  })();

  return new Response(stream.readable, {
    headers: {
      'Content-Type': 'text/event-stream',
      'Cache-Control': 'no-cache',
      'Connection': 'keep-alive'
    }
  });
}
```

---

## å…­ã€å‰ç«¯ç»„ä»¶å®ç°

### 6.1 SuperAgentNode ç»„ä»¶ç»“æ„

```typescript
// src/components/nodes/SuperAgentNode.tsx

import { useState, useCallback } from 'react';
import { Handle, Position } from 'reactflow';

interface SuperAgentNodeProps {
  data: SuperAgentNodeData;
  id: string;
}

export function SuperAgentNode({ data, id }: SuperAgentNodeProps) {
  const [userRequest, setUserRequest] = useState('');
  const [isProcessing, setIsProcessing] = useState(false);
  const [thoughtSteps, setThoughtSteps] = useState<ThoughtStep[]>([]);
  const [currentIteration, setCurrentIteration] = useState(0);
  const [result, setResult] = useState<FinalOutput | null>(null);
  const [matchedSkill, setMatchedSkill] = useState<string | null>(null);

  const handleGenerate = useCallback(async () => {
    setIsProcessing(true);
    setThoughtSteps([]);
    setResult(null);

    try {
      const response = await fetch('/api/super-agent/generate', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          userRequest,
          referenceImages: connectedImages
        })
      });

      const reader = response.body?.getReader();
      const decoder = new TextDecoder();

      while (true) {
        const { done, value } = await reader!.read();
        if (done) break;

        const text = decoder.decode(value);
        const lines = text.split('\n');

        for (const line of lines) {
          if (line.startsWith('data: ')) {
            const event = JSON.parse(line.slice(6));

            switch (event.type) {
              case 'thought_step':
                setThoughtSteps(prev => [...prev, {
                  iteration: event.iteration,
                  thought: event.thought,
                  action: event.action,
                  actionInput: event.actionInput,
                  observation: ''
                }]);
                setCurrentIteration(event.iteration);
                break;

              case 'observation':
                setThoughtSteps(prev => {
                  const updated = [...prev];
                  if (updated.length > 0) {
                    updated[updated.length - 1].observation =
                      JSON.stringify(event.data, null, 2);
                  }
                  return updated;
                });
                break;

              case 'skill_matched':
                setMatchedSkill(event.skillName);
                break;

              case 'complete':
                setResult(event.result);
                break;

              case 'error':
                console.error('Error:', event.error);
                break;
            }
          }
        }
      }
    } catch (error) {
      console.error('Generation failed:', error);
    } finally {
      setIsProcessing(false);
    }
  }, [userRequest, connectedImages]);

  return (
    <div className="super-agent-node">
      {/* è¾“å…¥åŒºåŸŸ */}
      <div className="input-section">
        <textarea
          value={userRequest}
          onChange={(e) => setUserRequest(e.target.value)}
          placeholder="æè¿°ä½ æƒ³è¦ç”Ÿæˆçš„å›¾ç‰‡..."
          disabled={isProcessing}
        />
        <button onClick={handleGenerate} disabled={isProcessing}>
          {isProcessing ? 'æ€è€ƒä¸­...' : 'ç”Ÿæˆæç¤ºè¯'}
        </button>
      </div>

      {/* æŠ€èƒ½åŒ¹é…æ˜¾ç¤º */}
      {matchedSkill && (
        <div className="skill-badge">
          ğŸ¯ åŒ¹é…æŠ€èƒ½: {matchedSkill}
        </div>
      )}

      {/* ReAct è¿‡ç¨‹å¯è§†åŒ– */}
      <div className="react-visualization">
        {thoughtSteps.map((step, index) => (
          <div key={index} className="thought-step">
            <div className="iteration">è¿­ä»£ {step.iteration}</div>
            <div className="thought">
              <span className="label">ğŸ’­ æ€è€ƒ:</span>
              {step.thought}
            </div>
            <div className="action">
              <span className="label">ğŸ”§ è¡ŒåŠ¨:</span>
              {step.action}
            </div>
            {step.observation && (
              <div className="observation">
                <span className="label">ğŸ‘ è§‚å¯Ÿ:</span>
                <pre>{step.observation}</pre>
              </div>
            )}
          </div>
        ))}
      </div>

      {/* æœ€ç»ˆç»“æœ */}
      {result && (
        <div className="result-section">
          <h3>âœ¨ æœ€ç»ˆæç¤ºè¯</h3>
          <pre className="final-prompt">{result.finalPrompt}</pre>

          <h4>ğŸ“ ä¸­æ–‡æ–‡å­—æ¸…å•</h4>
          <ul>
            {result.chineseTexts.map((text, i) => (
              <li key={i}>"{text}"</li>
            ))}
          </ul>

          <h4>ğŸ’¡ ç”Ÿæˆå»ºè®®</h4>
          <ul>
            {result.generationTips.map((tip, i) => (
              <li key={i}>{tip}</li>
            ))}
          </ul>

          <div className="meta-info">
            <span>æ¨èæ¨¡å‹: {result.recommendedModel}</span>
            <span>è¿­ä»£æ¬¡æ•°: {result.iterationCount}</span>
          </div>
        </div>
      )}

      <Handle type="target" position={Position.Left} />
      <Handle type="source" position={Position.Right} />
    </div>
  );
}
```

---

## ä¸ƒã€å…¸å‹å·¥ä½œæµç¤ºä¾‹

### ç¤ºä¾‹1: åŒ¹é…é¢„è®¾æŠ€èƒ½

```
ç”¨æˆ·è¾“å…¥: "å¸®æˆ‘ç”Ÿæˆä¸€ä¸ªæ‰‹æŒé€æ˜å¡ç‰‡çš„äº§å“å±•ç¤ºå›¾ï¼Œå±•ç¤ºæˆ‘çš„AIå¹³å°'åˆ›æ„æ— é™'"

Iteration 1:
  Thought: ç”¨æˆ·éœ€è¦äº§å“å±•ç¤ºå›¾ï¼Œæåˆ°äº†"æ‰‹æŒé€æ˜å¡ç‰‡"ï¼Œè¿™æ˜¯ä¸€ä¸ªå…¸å‹çš„äº§å“å±•ç¤ºåœºæ™¯ã€‚
           è®©æˆ‘å…ˆåŒ¹é…é¢„è®¾æŠ€èƒ½ã€‚
  Action: skill_matcher
  Input: { user_request: "å¸®æˆ‘ç”Ÿæˆä¸€ä¸ªæ‰‹æŒé€æ˜å¡ç‰‡çš„äº§å“å±•ç¤ºå›¾..." }
  Observation: { matched_skill: "product-showcase", confidence: 0.85 }

Iteration 2:
  Thought: åŒ¹é…åˆ°äº† product-showcase æŠ€èƒ½ï¼Œç½®ä¿¡åº¦å¾ˆé«˜ã€‚è®©æˆ‘åŠ è½½å®Œæ•´çš„æŠ€èƒ½æ¨¡æ¿ã€‚
  Action: load_skill
  Input: { skill_id: "product-showcase" }
  Observation: { ... å®Œæ•´çš„æŠ€èƒ½æ¨¡æ¿ ... }

Iteration 3:
  Thought: è·å¾—äº†æŠ€èƒ½æ¨¡æ¿ï¼Œéœ€è¦ä»ç”¨æˆ·éœ€æ±‚ä¸­æå–å˜é‡å€¼æ¥å¡«å……æ¨¡æ¿ã€‚
           äº§å“åç§°æ˜¯"åˆ›æ„æ— é™"ï¼Œä½†æ²¡æœ‰æä¾›å…·ä½“åŠŸèƒ½åˆ—è¡¨ï¼Œéœ€è¦åˆç†è¡¥å……ã€‚
  Action: generate_prompt
  Input: {
    user_request: "...",
    skill_template: { ... },
    variables: {
      PRODUCT_NAME: "åˆ›æ„æ— é™",
      PRODUCT_TYPE: "a creative AI platform",
      FEATURE_ICONS: "tool icons with labels: å›¾åƒç”Ÿæˆ, AIæ™ºèƒ½ä½“, åˆ›æ„å·¥å…·"
    }
  }
  Observation: { prompt_v1: "A hand holding a glowing transparent glass card..." }

Iteration 4:
  Thought: åˆç‰ˆæç¤ºè¯å·²ç”Ÿæˆï¼Œè®©æˆ‘è¯„ä¼°è´¨é‡ã€‚
  Action: evaluate_prompt
  Input: { prompt: "...", user_requirements: "...", chinese_texts: ["åˆ›æ„æ— é™", ...] }
  Observation: { score: 88, passed: true, issues: [] }

Iteration 5:
  Thought: è¯„ä¼°åˆ†æ•°88åˆ†ï¼Œè¶…è¿‡85åˆ†é˜ˆå€¼ï¼Œå¯ä»¥è¾“å‡ºæœ€ç»ˆç»“æœã€‚
  Action: finalize_output
  Input: { final_prompt: "...", chinese_texts: [...], generation_tips: [...] }

å®Œæˆï¼
```

### ç¤ºä¾‹2: è‡ªä¸»ç”Ÿæˆï¼ˆæ— åŒ¹é…æŠ€èƒ½ï¼‰

```
ç”¨æˆ·è¾“å…¥: "å¸®æˆ‘ç”Ÿæˆä¸€å¼ èµ›åšæœ‹å…‹é£æ ¼çš„åŸå¸‚å¤œæ™¯ï¼Œå¤©ç©ºä¸­æœ‰å·¨å¤§çš„å…¨æ¯å¹¿å‘Š"

Iteration 1:
  Thought: è¿™æ˜¯ä¸€ä¸ªé£æ ¼åŒ–åœºæ™¯ç”Ÿæˆéœ€æ±‚ï¼Œè®©æˆ‘å…ˆå°è¯•åŒ¹é…æŠ€èƒ½ã€‚
  Action: skill_matcher
  Input: { user_request: "..." }
  Observation: { matched_skill: null, reason: "æ²¡æœ‰åŒ¹é…çš„é¢„è®¾æŠ€èƒ½" }

Iteration 2:
  Thought: æ²¡æœ‰åŒ¹é…çš„é¢„è®¾æŠ€èƒ½ï¼Œéœ€è¦è‡ªä¸»ç”Ÿæˆã€‚
           èµ›åšæœ‹å…‹é£æ ¼æœ‰ç‰¹å®šçš„è§†è§‰è¯­è¨€ï¼Œè®©æˆ‘æœç´¢ä¸€ä¸‹æœ€ä½³å®è·µã€‚
  Action: web_search
  Input: { query: "cyberpunk style AI image prompt best practices", search_type: "style_reference" }
  Observation: { results: [...], summary: "èµ›åšæœ‹å…‹é£æ ¼å…³é”®è¯ï¼šneon lights, rain-soaked streets, holographic displays..." }

Iteration 3:
  Thought: è·å¾—äº†é£æ ¼å‚è€ƒï¼Œç°åœ¨å¯ä»¥ç”Ÿæˆæç¤ºè¯äº†ã€‚
  Action: generate_prompt
  Input: { user_request: "...", reference_analysis: "...", optimization_tips: [...] }
  Observation: { prompt_v1: "A breathtaking cyberpunk cityscape at night..." }

Iteration 4:
  Thought: æ£€æŸ¥æç¤ºè¯è´¨é‡ã€‚
  Action: evaluate_prompt
  Input: { ... }
  Observation: { score: 78, issues: ["ç¼ºå°‘å…·ä½“çš„éœ“è™¹ç¯é¢œè‰²æè¿°"] }

Iteration 5:
  Thought: åˆ†æ•°ä¸å¤Ÿï¼Œéœ€è¦ä¼˜åŒ–ã€‚
  Action: optimize_prompt
  Input: { current_prompt: "...", issues: ["ç¼ºå°‘å…·ä½“çš„éœ“è™¹ç¯é¢œè‰²æè¿°"], iteration: 1 }
  Observation: { optimized_prompt: "...with vibrant neon lights in pink, cyan and purple..." }

Iteration 6:
  Thought: å†æ¬¡è¯„ä¼°ä¼˜åŒ–åçš„æç¤ºè¯ã€‚
  Action: evaluate_prompt
  Input: { ... }
  Observation: { score: 91, passed: true }

Iteration 7:
  Thought: åˆ†æ•°è¾¾æ ‡ï¼Œè¾“å‡ºæœ€ç»ˆç»“æœã€‚
  Action: finalize_output
  Input: { ... }

å®Œæˆï¼
```

---

## å…«ã€ä¸‹ä¸€æ­¥å®ç°è®¡åˆ’

1. **Phase 1**: å®ç°æŠ€èƒ½åº“æ•°æ®ç»“æ„å’ŒåŸºç¡€å·¥å…·
2. **Phase 2**: å®ç° ReAct å¾ªç¯æ ¸å¿ƒé€»è¾‘
3. **Phase 3**: å®ç°æµå¼ API å’Œå‰ç«¯ç»„ä»¶
4. **Phase 4**: é›†æˆæœç´¢å’Œå›¾ç‰‡åˆ†æå·¥å…·
5. **Phase 5**: æµ‹è¯•å’Œä¼˜åŒ–è¿­ä»£é€»è¾‘
